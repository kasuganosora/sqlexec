# 独立服务器概述

SQLExec 可以作为独立服务器运行，同时提供三种协议接入方式，满足不同场景下的数据访问需求。

## 架构概览

```
┌─────────────────────────────────────────────────────────┐
│                       客户端                             │
│                                                         │
│   MySQL CLI / App        HTTP Client        AI 工具     │
│   (mysql, Go, Python,    (curl, fetch,      (Claude,    │
│    Java, Node.js)         Postman)           Cursor)    │
└────────┬─────────────────────┬──────────────────┬───────┘
         │                     │                  │
         ▼                     ▼                  ▼
┌────────────────┐  ┌──────────────────┐  ┌──────────────┐
│ MySQL 协议     │  │ HTTP REST API    │  │ MCP Server   │
│ 默认端口: 3306 │  │ 默认端口: 8080   │  │ 默认端口: 8081│
└────────┬───────┘  └────────┬─────────┘  └──────┬───────┘
         │                   │                    │
         └───────────────────┼────────────────────┘
                             │
                             ▼
              ┌──────────────────────────┐
              │    共享 SQL 查询引擎      │
              │  (解析 → 优化 → 执行)     │
              └─────────────┬────────────┘
                            │
                            ▼
              ┌──────────────────────────┐
              │       数据源管理          │
              │                          │
              │  ┌──────┐  ┌──────────┐  │
              │  │内置存储│  │MySQL/PG  │  │
              │  └──────┘  └──────────┘  │
              └──────────────────────────┘
```

三种协议共享同一个 SQL 查询引擎和数据源，确保数据访问行为一致。

## 三种协议对比

| 特性 | MySQL 协议 | HTTP REST API | MCP Server |
|------|-----------|---------------|------------|
| 默认端口 | 3306 | 8080 | 8081 |
| 适用场景 | 传统数据库客户端、ORM 框架 | Web 应用、微服务 | AI 工具（Claude、Cursor） |
| 认证方式 | mysql_native_password | Bearer Token / API Key | Bearer Token |
| 传输协议 | MySQL Wire Protocol | HTTP/1.1、HTTP/2 | Streamable HTTP |
| 会话状态 | 有状态（连接级会话） | 无状态 | 无状态 |
| 事务支持 | 支持 | 单语句 | 单语句 |

## 快速启动

### 编译

```bash
go build -o sqlexec ./cmd/service
```

### 运行

```bash
./sqlexec
```

服务器启动后，三种协议将根据配置文件中的设置自动启用。

### 配置文件

通过配置文件控制启用哪些协议：

```json
{
  "mysql": {
    "enabled": true,
    "host": "0.0.0.0",
    "port": 3306
  },
  "http_api": {
    "enabled": true,
    "host": "0.0.0.0",
    "port": 8080
  },
  "mcp": {
    "enabled": true,
    "host": "0.0.0.0",
    "port": 8081
  }
}
```

将 `enabled` 设为 `false` 可以禁用不需要的协议。

## 共享引擎

三种协议的核心优势在于它们共享同一个查询引擎：

- **统一的 SQL 解析器** — 所有协议使用相同的 SQL 语法解析
- **统一的查询优化器** — 查询计划生成和优化逻辑一致
- **统一的数据源** — 通过 `USE database_name` 或请求参数指定数据源，所有协议可访问相同的数据
- **统一的权限模型** — RBAC 权限控制对所有协议生效
- **统一的审计日志** — 所有协议的操作均被记录到同一个审计日志系统
